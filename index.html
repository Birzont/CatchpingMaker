<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>캐치핑 커스터마이징</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }
        canvas {
            border: 1px solid #000;
            background-color: white;
        }
        #customizationPanel {
            display: flex;
            flex-direction: column;
            margin-top: 10px;
            width: 300px;
        }
        .tab-buttons {
            display: flex;
            justify-content: space-around;
            margin-bottom: 10px;
        }
        .tab-button {
            cursor: pointer;
            padding: 10px 20px;
            background-color: #f1f1f1;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        .tab-button:hover, .tab-button.active {
            background-color: #ddd;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .color-button, .item-button {
            width: 40px;
            height: 40px;
            border: none;
            margin: 5px;
            cursor: pointer;
        }
        .color-button {
            border-radius: 50%;
        }
        .item-button img {
            width: 100%;
            height: 100%;
        }
        .color-input {
            margin: 5px;
        }
    </style>
</head>
<body>
    <h2>캐치핑 커스터마이징</h2>
    <canvas id="avatarCanvas" width="400" height="400"></canvas>

    <!-- Customization Panel -->
    <div id="customizationPanel">
        <!-- 탭 버튼 -->
        <div class="tab-buttons">
            <button class="tab-button" data-tab="bodyTab">몸통</button>
            <button class="tab-button" data-tab="hairTab">머리</button>
            <button class="tab-button" data-tab="customImageTab">사용자 지정 이미지</button>
        </div>

        <!-- 몸통 탭 -->
        <div class="tab-content" id="bodyTab">
            <p>몸통 스타일</p>
            <button class="item-button" data-image="body1.png"><img src="body1.png" alt="몸통1"></button>
            <button class="item-button" data-image="body2.png"><img src="body2.png" alt="몸통2"></button>
            <!-- 더 많은 몸통 스타일 추가 -->
        </div>

        <!-- 머리 탭 -->
        <div class="tab-content" id="hairTab">
            <p>머리 스타일</p>
            <button class="item-button" data-image="euhair1.png"><img src="euhair1.png" alt="유럽머리1"></button>
            <button class="item-button" data-image="euhair2.png"><img src="euhair2.png" alt="유럽머리2"></button>
        </div>

        <!-- 사용자 지정 이미지 탭 -->
        <div class="tab-content" id="customImageTab">
            <p>사용자 지정 이미지를 업로드하세요</p>
            <input type="file" id="customImageUpload" accept="image/*">
            <label for="customImageSize">이미지 크기:</label>
            <input type="range" id="customImageSize" min="10" max="400" value="100">
            <label for="customImageX">X 위치:</label>
            <input type="range" id="customImageX" min="0" max="400" value="100">
            <label for="customImageY">Y 위치:</label>
            <input type="range" id="customImageY" min="0" max="400" value="100">
        </div>
    </div>

    <button id="saveAvatar">아바타 저장</button>

    <script>
        const canvas = document.getElementById('avatarCanvas');
        const ctx = canvas.getContext('2d');

        const bodyButtons = document.querySelectorAll('#bodyTab .item-button');
        const hairButtons = document.querySelectorAll('#hairTab .item-button');
        const customImageUpload = document.getElementById('customImageUpload');
        const customImageSizeInput = document.getElementById('customImageSize');
        const customImageXInput = document.getElementById('customImageX');
        const customImageYInput = document.getElementById('customImageY');
        const saveButton = document.getElementById('saveAvatar');
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');

        let selectedBodyImage = 'body.png';  // 기본 몸통 이미지
        let selectedHairImage = null;
        let uploadedImage = null;
        let uploadedImageSize = 100;
        let uploadedImageX = 100;
        let uploadedImageY = 100;

        function loadImage(src) {
            return new Promise((resolve) => {
                const img = new Image();
                img.crossOrigin = "Anonymous";
                img.src = src;
                img.onload = () => resolve(img);
            });
        }

        async function drawAvatar() {
            // 캔버스 초기화
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // 몸통 그리기
            const bodyImage = await loadImage(selectedBodyImage);
            ctx.drawImage(bodyImage, 0, 0, 400, 400);

            // 머리 그리기
            if (selectedHairImage) {
                const hairImage = await loadImage(selectedHairImage);
                ctx.drawImage(hairImage, 0, 0, 400, 400);
            }

            // 업로드된 이미지 그리기
            if (uploadedImage) {
                ctx.drawImage(uploadedImage, uploadedImageX, uploadedImageY, uploadedImageSize, uploadedImageSize);
            }
        }

        // 몸통 버튼 이벤트 리스너
        bodyButtons.forEach(button => {
            button.addEventListener('click', (e) => {
                selectedBodyImage = e.target.closest('button').dataset.image;
                drawAvatar();
            });
        });

        // 머리 버튼 이벤트 리스너
        hairButtons.forEach(button => {
            button.addEventListener('click', (e) => {
                selectedHairImage = e.target.closest('button').dataset.image;
                drawAvatar();
            });
        });

        // 사용자 지정 이미지 업로드
        customImageUpload.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    uploadedImage = new Image();
                    uploadedImage.src = event.target.result;
                    uploadedImage.onload = drawAvatar;
                };
                reader.readAsDataURL(file);
            }
        });

        // 사용자 지정 이미지 크기 및 위치 조정
        customImageSizeInput.addEventListener('input', (e) => {
            uploadedImageSize = e.target.value;
            drawAvatar();
        });

        customImageXInput.addEventListener('input', (e) => {
            uploadedImageX = e.target.value;
            drawAvatar();
        });

        customImageYInput.addEventListener('input', (e) => {
            uploadedImageY = e.target.value;
            drawAvatar();
        });

        // 저장 버튼 클릭
        saveButton.addEventListener('click', () => {
            const link = document.createElement('a');
            link.download = 'custom_avatar.png';
            link.href = canvas.toDataURL();
            link.click();
        });

        // 탭 기능 구현
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));

                button.classList.add('active');
                document.getElementById(button.dataset.tab).classList.add('active');
            });
        });

        // 기본 탭 활성화
        tabButtons[0].classList.add('active');
        tabContents[0].classList.add('active');

        // 초기 아바타 그리기
        drawAvatar();
    </script>

</body>
</html>