<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>만들어쓰는 나만핑</title>
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f4f4f9;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }
        
        canvas {
            border: 2px solid #ccc;
            border-radius: 10px;
            background-color: #fff;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        #customizationPanel {
            display: flex;
            flex-direction: column;
            margin-top: 10px;
            padding: 10px;
            width: 400px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .tab-buttons {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .tab-button {
            cursor: pointer;
            padding: 10px 15px;
            background-color: #e9e9ef;
            width: 100px;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            color: #333;
            transition: background-color 0.3s, color 0.3s;
        }
        
        .tab-button:hover,
        .tab-button.active {
            background-color: #333;
            color: #fff;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .color-button,
        .item-button {
            width: 40px;
            height: 40px;
            margin: 5px;
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid transparent;
            transition: transform 0.3s;
        }
        
        .color-button:hover,
        .item-button:hover {
            transform: scale(1.1);
        }
        
        .item-button img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 2px solid #ccc;
            transition: border 0.3s;
        }
        
        .item-button:hover img {
            border-color: #333;
        }
        
        #saveAvatar {
            margin-top: 15px;
            padding: 12px 30px;
            width: 280px;
            font-size: 16px;
            font-weight: bold;
            color: #fff;
            background-color: #333;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        #saveAvatar:hover {
            background-color: #555;
        }
        

        #shareAvatar {
            margin-top: 15px;
            padding: 12px 30px;
            width: 280px;
            font-size: 16px;
            font-weight: bold;
            color: #fff;
            background-color: #333;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        #shareAvatar:hover {
            background-color: #555;
        }


        input[type="color"] {
            width: 50px;
            height: 50px;
            border: none;
            margin: 10px 0;
            cursor: pointer;
        }
        
    </style>
</head>
<body>

    <br>
    <br>
    <h2>만들어쓰는 나만핑</h2>
    <canvas id="avatarCanvas" width="420" height="420"></canvas>

    <!-- Customization Panel -->
    <div id="customizationPanel">

        <!-- 탭 버튼 -->
        <div class="tab-buttons">
            <button class="tab-button" data-tab="bodyTab">몸통</button>
            <button class="tab-button" data-tab="bodyColorsTab">색상</button>
            <button class="tab-button" data-tab="hairTab">옷</button>
            <button class="tab-button" data-tab="headAccessoryTab">모자</button>
            <button class="tab-button" data-tab="handItemTab">아이템</button> 
            <button class="tab-button" data-tab="customImageTab">사진</button> 

 
        </div>

        <!-- 몸통 색상 탭 -->
        <div class="tab-content" id="bodyColorsTab">
            <button class="color-button" style="background-color: #FF0000;" data-color="#FF0000"></button>
            <button class="color-button" style="background-color: #FFA500;" data-color="#FFA500"></button>
            <button class="color-button" style="background-color: #FFFF00;" data-color="#FFFF00"></button>
            <button class="color-button" style="background-color: #008000;" data-color="#008000"></button>
            <button class="color-button" style="background-color: #0000FF;" data-color="#0000FF"></button>
            <button class="color-button" style="background-color: #800080;" data-color="#800080"></button>
            <button class="color-button" style="background-color: #FFC0CB;" data-color="#FFC0CB"></button>
            <button class="color-button" style="background-color: #000000;" data-color="#000000"></button>
            <button class="color-button" style="background-color: #32CD32;" data-color="#32CD32"></button>
            <input class="color-input" type="color" value="#FFFFFF" id="customColor">
        </div>

        <!-- 몸통 탭 -->
        <div class="tab-content" id="bodyTab">
            <div style="text-align: center; font-weight: bold; font-size: 22px;">
                <a style="color: #000000;">HAHA</a>
            </div>
            <p>몸통 선택</p>
            <button class="item-button" data-image="body1.png"><img src="body1.png" alt="몸통1"></button>
            <button class="item-button" data-image="body2.png"><img src="body2.png" alt="몸통2"></button>
            <button class="item-button" data-image="body3.png"><img src="body3.png" alt="몸통3"></button>
            <button class="item-button" data-image="body4.png"><img src="body4.png" alt="몸통4"></button>
            <button class="item-button" data-image="body5.png"><img src="body5.png" alt="몸통5"></button>
            <button class="item-button" data-image="body6.png"><img src="body6.png" alt="몸통6"></button>
            <button class="item-button" data-image="body7.png"><img src="body7.png" alt="몸통7"></button>
            <button class="item-button" data-image="body8.png"><img src="body8.png" alt="몸통8"></button>
            <button class="item-button" data-image="body9.png"><img src="body9.png" alt="몸통9"></button>
            <button class="item-button" data-image="body10.png"><img src="body10.png" alt="몸통10"></button>
            <button class="item-button" data-image="body11.png"><img src="body11.png" alt="몸통11"></button>
            <button class="item-button" data-image="body12.png"><img src="body12.png" alt="몸통12"></button>
            <button class="item-button" data-image="body13.png"><img src="body13.png" alt="몸통13"></button>
            <button class="item-button" data-image="body14.png"><img src="body14.png" alt="몸통14"></button>
            <button class="item-button" data-image="body15.png"><img src="body15.png" alt="몸통15"></button>
            <button class="item-button" data-image="body16.png"><img src="body16.png" alt="몸통16"></button>
            <button class="item-button" data-image="body17.png"><img src="body17.png" alt="몸통17"></button>
            <button class="item-button" data-image="body18.png"><img src="body18.png" alt="몸통18"></button>
            <button class="item-button" data-image="body19.png"><img src="body19.png" alt="몸통19"></button>
            <button class="item-button" data-image="body20.png"><img src="body20.png" alt="몸통20"></button>
        </div>

        <!-- 머리 탭 -->
        <div class="tab-content" id="hairTab">
            <div style="text-align: center; font-weight: bold; font-size: 22px;">
                <a style="color: #000000;">HAHA</a>
            </div>
            <p>유럽 스타일 머리</p>
            <button class="item-button" data-image="euhair1.png"><img src="euhair1.png" alt="유럽머리1"></button>
            <button class="item-button" data-image="euhair2.png"><img src="euhair2.png" alt="유럽머리2"></button>
            <!-- 중략 -->
            <!-- 다른 스타일 머리 그룹도 동일하게 추가 -->
        </div>

        <!-- 머리장식 탭 -->
        <div class="tab-content" id="headAccessoryTab">
            <div style="text-align: center; font-weight: bold; font-size: 22px;">
                <a style="color: #000000;">HAHA</a>
            </div>

            <button class="item-button" data-image="안경.png"><img src="안경.png" alt="안경"></button>
            <button class="item-button" data-image="영국모자.png"><img src="영국모자.png" alt="영국모자"></button>
            <!-- 나머지 머리장식 추가 -->
        </div>

        <!-- 손 아이템 탭 -->
        <div class="tab-content" id="handItemTab">
            <div style="text-align: center; font-weight: bold; font-size: 22px;">
                <a style="color: #000000;">HAHA</a>
            </div>

            <button class="item-button" data-image="item1.png"><img src="item1.png" alt="item1"></button>
            <button class="item-button" data-image="item2.png"><img src="item2.png" alt="item2"></button>
            <!-- 나머지 손 아이템 추가 -->
        </div>
 

         <!-- 사용자 지정 이미지 업로드 및 제어 탭 -->
<div class="tab-content" id="customImageTab">
    <div style="text-align: center; font-weight: bold; font-size: 22px;">
        <a style="color: #000000;">HAHA</a>
    </div>

    <input type="file" id="uploadImage" accept="image/*">
    <p>이미지를 업로드하고 캔버스에서 드래그하여 이동 및 크기 조절하세요.</p>
</div>




    </div>

    <button id="saveAvatar">나만핑 저장</button>
    <button id="shareAvatar">공유하기</button>



    <script>
        const canvas = document.getElementById('avatarCanvas');
        const ctx = canvas.getContext('2d');
    
        const bodyColorButtons = document.querySelectorAll('.color-button');
        const bodyButtons = document.querySelectorAll('#bodyTab .item-button');
        const hairButtons = document.querySelectorAll('#hairTab .item-button');
        const headAccessoryButtons = document.querySelectorAll('#headAccessoryTab .item-button');
        const handItemButtons = document.querySelectorAll('#handItemTab .item-button');
        const saveButton = document.getElementById('saveAvatar');
        const customColorInput = document.getElementById('customColor');
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');
    
        const defaultBodyImageSrc = 'body.png'; // 기본 몸통 이미지
        let selectedBodyImage = defaultBodyImageSrc; 
        let bodyColor = '#FFFFFF';
        let selectedHairImage = null;
        let selectedHeadAccessoryImage = null;
        let selectedHandItemImage = null;
    
        let uploadedImage = null;
        let imageX = 50, imageY = 50;  // 이미지 초기 위치
        let imageWidth = 100, imageHeight = 100;  // 이미지 초기 크기
        let isDragging = false;
        let resizing = false;
        let dragOffsetX = 0, dragOffsetY = 0;
    
        // 이미지 업로드 처리
        document.getElementById('uploadImage').addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = function() {
                        uploadedImage = img;
                        drawAvatar();
                    };
                };
                reader.readAsDataURL(file);
            }
        });
    
        // 캔버스에서 이미지 드래그 및 크기 조절 이벤트
        canvas.addEventListener('mousedown', (e) => {
            const mouseX = e.offsetX;
            const mouseY = e.offsetY;
    
            // 이미지가 클릭되었는지 확인
            if (mouseX > imageX && mouseX < imageX + imageWidth && mouseY > imageY && mouseY < imageY + imageHeight) {
                isDragging = true;
                dragOffsetX = mouseX - imageX;
                dragOffsetY = mouseY - imageY;
            }
    
            // 크기 조정 핸들 클릭 확인 (오른쪽 아래 10x10 영역)
            if (mouseX > imageX + imageWidth - 10 && mouseY > imageY + imageHeight - 10) {
                resizing = true;
            }
        });
    
        canvas.addEventListener('mousemove', (e) => {
            if (isDragging) {
                imageX = e.offsetX - dragOffsetX;
                imageY = e.offsetY - dragOffsetY;
                drawAvatar();
            }
    
            if (resizing) {
                imageWidth = e.offsetX - imageX;
                imageHeight = e.offsetY - imageY;
                drawAvatar();
            }
        });
    
        canvas.addEventListener('mouseup', () => {
            isDragging = false;
            resizing = false;
        });
    
        // 업로드된 이미지 그리기 함수 (점선과 핸들을 포함)
        async function drawAvatar() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);  // 캔버스 초기화
    
            // 기본 몸통 이미지 그리기
            const bodyImg = await loadImage(selectedBodyImage);
            ctx.fillStyle = bodyColor;
            ctx.fillRect(0, 0, canvas.width, canvas.height); // 배경 색상
            ctx.drawImage(bodyImg, 0, 0, canvas.width, canvas.height);
    
            if (selectedHairImage) {
                const hairImg = await loadImage(selectedHairImage);
                ctx.drawImage(hairImg, 0, 0, canvas.width, canvas.height);
            }
    
            if (selectedHeadAccessoryImage) {
                const headAccessoryImg = await loadImage(selectedHeadAccessoryImage);
                ctx.drawImage(headAccessoryImg, 0, 0, canvas.width, canvas.height);
            }
    
            if (selectedHandItemImage) {
                const handItemImg = await loadImage(selectedHandItemImage);
                ctx.drawImage(handItemImg, 0, 0, canvas.width, canvas.height);
            }
    
            // 업로드된 이미지 그리기
            if (uploadedImage) {
                ctx.drawImage(uploadedImage, imageX, imageY, imageWidth, imageHeight);
    
                // 가장자리에 점선 그리기
                ctx.setLineDash([6]);  // 점선 설정
                ctx.strokeStyle = 'black';
                ctx.strokeRect(imageX, imageY, imageWidth, imageHeight);
    
                // 네 모서리에 작은 사각형(핸들) 그리기
                const handleSize = 10;
                ctx.fillStyle = 'blue';
    
                // 왼쪽 위
                ctx.fillRect(imageX - handleSize / 2, imageY - handleSize / 2, handleSize, handleSize);
    
                // 오른쪽 위
                ctx.fillRect(imageX + imageWidth - handleSize / 2, imageY - handleSize / 2, handleSize, handleSize);
    
                // 왼쪽 아래
                ctx.fillRect(imageX - handleSize / 2, imageY + imageHeight - handleSize / 2, handleSize, handleSize);
    
                // 오른쪽 아래 (크기 조절 핸들)
                ctx.fillRect(imageX + imageWidth - handleSize / 2, imageY + imageHeight - handleSize / 2, handleSize, handleSize);
            }
        }
    
        // 점선과 핸들을 제외한 아바타 그리기 (저장용)
        async function drawAvatarForSave() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);  // 캔버스 초기화
    
            // 기본 몸통 이미지 그리기
            const bodyImg = await loadImage(selectedBodyImage);
            ctx.fillStyle = bodyColor;
            ctx.fillRect(0, 0, canvas.width, canvas.height); // 배경 색상
            ctx.drawImage(bodyImg, 0, 0, canvas.width, canvas.height);
    
            if (selectedHairImage) {
                const hairImg = await loadImage(selectedHairImage);
                ctx.drawImage(hairImg, 0, 0, canvas.width, canvas.height);
            }
    
            if (selectedHeadAccessoryImage) {
                const headAccessoryImg = await loadImage(selectedHeadAccessoryImage);
                ctx.drawImage(headAccessoryImg, 0, 0, canvas.width, canvas.height);
            }
    
            if (selectedHandItemImage) {
                const handItemImg = await loadImage(selectedHandItemImage);
                ctx.drawImage(handItemImg, 0, 0, canvas.width, canvas.height);
            }
    
            // 업로드된 이미지 그리기 (점선과 핸들 제외)
            if (uploadedImage) {
                ctx.drawImage(uploadedImage, imageX, imageY, imageWidth, imageHeight);
            }
        }
    
        function loadImage(src) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => resolve(img);
                img.src = src;
            });
        }
    
        bodyColorButtons.forEach(button => {
            button.addEventListener('click', () => {
                bodyColor = button.getAttribute('data-color');
                drawAvatar();
            });
        });
    
        customColorInput.addEventListener('input', () => {
            bodyColor = customColorInput.value;
            drawAvatar();
        });
    
        bodyButtons.forEach(button => {
            button.addEventListener('click', () => {
                selectedBodyImage = button.getAttribute('data-image');
                drawAvatar();
            });
        });
    
        hairButtons.forEach(button => {
            button.addEventListener('click', () => {
                selectedHairImage = button.getAttribute('data-image');
                drawAvatar();
            });
        });
    
        headAccessoryButtons.forEach(button => {
            button.addEventListener('click', () => {
                selectedHeadAccessoryImage = button.getAttribute('data-image');
                drawAvatar();
            });
        });
    
        handItemButtons.forEach(button => {
            button.addEventListener('click', () => {
                selectedHandItemImage = button.getAttribute('data-image');
                drawAvatar();
            });
        });
    
        // Save button event listener
        saveButton.addEventListener('click', async () => {
            await drawAvatarForSave();  // 저장용 아바타 그리기
            const link = document.createElement('a');
            link.download = 'custom_avatar.png';
            link.href = canvas.toDataURL();
            link.click();
            drawAvatar();  // 다시 점선과 핸들이 있는 아바타 그리기
        });
    
        // 탭 기능 구현
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const targetTab = button.getAttribute('data-tab');
                tabButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                tabContents.forEach(tab => {
                    if (tab.id === targetTab) {
                        tab.classList.add('active');
                    } else {
                        tab.classList.remove('active');
                    }
                });
            });
        });
    
        drawAvatar(); // 초기 아바타 그리기
    </script>
    
    
    
</body>
</html>
